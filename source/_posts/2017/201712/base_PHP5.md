---
title: PHP_基础 (5)
date: 2017-12-26
tags: PHP
toc: true
---

### 性能优化建议
- 在includes和requires中使用绝对路径,这样在分析路径花的时间更少;
- 在循环里别用函数,例如For(\$x=0; \$x < count(\$array); \$x), count()函数在外面先计算;
- 使用error_reporting(0)函数来预防潜在的敏感信息显示给用户.理想的错误报告应该被完全禁用在php.ini文件里.可是如果你在用一个共享的虚拟主机,php.ini你不能修改,那么你最好添加error_reporting(0)函数,放在每个脚本文件的第一行(或用require_once()来加载）这能有效的保护敏感的SQL查询和路径在出错时不被显示;
- 禁止过多的循环套循环,嵌套过多的循环会拉低执行效率
- 禁止在循环内部执行相关的查询语句,除非万不得以,不然千万不可这么操作
- 尽量使用单引号联接字符串
- 尽可能的减少变量复制操作.例如：\$description = $_POST['description'];
- 当if/else过多时,尽可能的使用switch/case 代替 if/else.能够使代码更加简明
- 开启缓存机制有助于提升性能,同时降低MySQL负载
- 开启gzip压缩

<!-- more -->

## 安全管理总结

### XSS跨站脚本
- 概念：GET或POST内容未过滤,可以提交JS以及HTML等恶意代码.
- 预防：所有传递到后台的数据都要过滤HTML标签

### CSRF跨站攻击
- 概念：强迫受害者的浏览器向一个易受攻击的Web应用程序发送请求,最后达到攻击者所需要的操作行为
- 预防：采用类似随即码或者令牌的形式,让用户操作唯一性(token)

### flash安全问题
- 概念：是否允许远程的flash加载
- 预防：不需要远程flash加载删除crossdomain.xml文件,否则,在crossdomain.xml的allow-access-from的domain属性中设置允许访问的白名单

### sql注入安全问题
- 概念：通过把SQL命令插入到Web表单递交或输入域名或页面请求的查询字符串,最终达到欺骗服务器执行恶意的SQL命令
- 预防：POST提交,过滤参数,PDO绑定

### XML注入安全问题
- 概念：和SQL注入原理一样,XML文件也可以是储存数据的地方
- 预防：对php处理XML文档的时候,进行标签过滤
- 预防：对php处理XML文档的时候,进行标签过滤

### url跳转漏洞
- 概念：Web应用程序接收到用户提交的URL参数后,没有对参数做”可信任URL”的验证,就向用户浏览器返回跳转到该URL的指令
- 预防：对跳转的php函数进行进一步优化,使页面跳转可以在可信任的范围内. 例如可以有跳转域名白名单方法

### 文件系统跨越漏洞
- 概念：对文件目录参数没有进行过滤,导致恶意用户可以通过在参数中输入一些执行命令,或者跨越访问的行为,来超出用户的访问权限
- 预防：对文本操作的时候一定要谨慎,不可信任
- 预防：严格使用phpwind中安全类库 escapePath函数

### 系统命令漏洞
- 概念：用户提交的参数用于执行系统命令的参数.
- 预防：谨慎使用系统命令,对使用系统命令的地方需要进行安全评审
- 预防： 对命令语句进行严格过滤

### 文件上传漏洞
- 概念：Web应用程序在处理用户上传的文件时,没有判断文件的扩展名是否在允许的范围内,或者没检测文件内容的合法性,就把文件保存在服务器上,甚至上传脚本木马到web服务器上,直接控制web服务器
- 预防：使用安全的,可信任的上传组件.
- 预防：检查文件扩展名,保证文件的类型正确.
- 预防：检查文件内容,保证用户不伪造文件类型

### 任意文件下载漏洞
- 预防：Apache虚拟目录指向
- 预防：Java/PHP读取文件

### 权限控制漏洞
- 概念：业务逻辑上的漏洞
- 预防：项目先期,做一份详细的权限规划文档.
- 预防：在开发中严格按照权限文档的要求去做权限.
- 预防：后期测试需要覆盖权限这一块功能区.
- 预防：程序员需要经常注意这些方面的要求.

### cookie安全设置
- cookie httponly flag ： 
    在用到用户名登陆密码之类的安全性比较高的cookie的时候,可以在cookie中设置httponly属性,该属性只允许php等访问cookie,而不允许js访问.
- cookie secure flag ： 
    在涉及到https这样的情况,需要对cookie加密传输,那么可以设置这个属性

### session安全
- 预防：SESSION是保存在服务器端的,具有比COOKIE一定的安全性.
- 预防：使用COOKIE的时候,如果长时间没有动作,可以设置一个时间值,来对COOKIE进行过期.
- 预防：尽量让用户每次的cookie值都是不同的,这样可以保证cookie被盗取也不能长期使用的问题.