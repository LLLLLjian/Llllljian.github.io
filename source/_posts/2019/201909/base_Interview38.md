---
title: Interview_总结 (38)
date: 2019-09-26
tags: Interview
toc: true
---

### 笔试总结
    列一下你的笔试题

<!-- more -->

#### redis备份方式
- RDB
    * 对内存中数据库状态进行快照
    * 将redis在内存中的数据库状态保存到磁盘里面,RDB文件是一个经过压缩的二进制文件,通过该文件可以还原生成RDB文件的数据状态
    * 生成方式
        * 指向命令手动生成
            * 有两个redis命令可以生成RDB文件,一个是SAVE,另一个是BGSAVE,SAVE命令会阻塞redis服务器进程,直到RDB文件创建完毕为止,在服务器阻塞期间,服务器不能处理任何的进程,BGSAVE会派出一个子进程,然后由子进程负责创建RDB文件,服务器进程(父进程)继续处理命令请求,创建RDB文件结束之前,客户端发送的 BGSAVE 和 SAVE 命令会被服务器拒绝
        * 通过配置自动生成
            * 可以设置服务器配置的save选项,让服务器每隔一段时间自动执行一次BGSAVE命令,可以通过save选项设置多个保存条件,但只要其中任意一个条件被满足就会执行BGSAGE命令
    * 数据恢复方式
        * ROB文件的载入工作是在服务器启动时自动执行的,没有专门用于载入ROB文件命令,只要redis服务器再启动时检测到ROB文件存在,它就会自动载入ROB的文件,在服务器载入的期间,会一直处于阻塞状态,直到载入工作完成为止
    * 特点
        * bgsave在进行fork操作时redis主进程会阻塞
        * 子进程向硬盘写数据也会带来IO压力,但数据的完整性和一致性受备份条件影响可能较差
    * 优势
        * 使用单独子进程来进行持久化,主进程不会进行任何IO操作,保证了redis的高性能
    * 劣势
        * RDB是间隔一段时间进行持久化,如果持久化之间redis发生故障,会发生数据丢失
- AOF
    * 把每条写命令都写入文件
    * 三种方式, 默认并且推荐每秒刷新
        * appendfsync always -- 每提交一个修改命令都调用fsync到AOF文件,非常慢,但是很安全
        * appendfsync everysec -- 每秒都调用fsyns刷新到AOF文件,很快但可能丢失一秒内的数据
        * appendfsync no -- 依靠OS进行刷新,redis不主动刷新AOF,这样最快但是安全性差
    * 数据恢复过程
        * 载入AOF文件
        * 创建模拟客户端
        * 从AOF文件中读取一条命令 
        * 使用模拟客户端执行命令
        * 循环读取并执行命令,直到全部完成
        * 如果同时启动了AOF和ROB方式,AOF优先,启动时只加载AOF文件恢复数据
    *  特点
        * 由于持续的写入IO压力更大,但数据的一致性和完整性较好
    * 优势
        * 可以保持更高的数据完整性,如果设置追加file的时间是1s,如果redis发生故障,最多会丢失1s的数据；且如果日志写入不完整支持redis-check-aof来进行日志修复；AOF文件没被rewrite之前(文件过大时会对命令进行合并重写),可以删除其中的某些命令(比如误操作的flushall)
    * 劣势
        * AOF文件比RDB文件大,且恢复速度慢

