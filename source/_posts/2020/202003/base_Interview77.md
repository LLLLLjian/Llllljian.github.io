---
title: Interview_总结 (77)
date: 2020-03-18
tags: Interview
toc: true
---

### 面试题
    今日被问傻系列-REDIS持久化

<!-- more -->

#### 持久化概念
1. RDB持久化方式能够在指定的时间间隔能对你的数据进行快照存储.
2. AOF持久化方式记录每次对服务器写的操作,当服务器重启的时候会重新执行这些命令来恢复原始的数据,AOF命令以redis协议追加保存每次写的操作到文件末尾,redis还能对AOF文件进行后台重写,使得AOF文件的体积不至于过大.
3. 如果你只希望你的数据在服务器运行的时候存在,你也可以不适用任何持久化方式.
4. 也可以同时开启两种持久化方式,在这种情况下,当redis重启的时候会有限载入AOF文件来恢复原始的数据,因为在通常情况下AOF文件保存的数据集比RDB文件保存的数据集要完整

#### RDB的优缺点
- 优点
    1. RDB是一个非常紧凑的文件,它保存了某个时间点的数据集,非常适用于数据集的备份,这样即使出了问题你也可以根据需求恢复到不同版本的数据集.
    2. RDB是一个紧凑的单一文件,很方便传送到另一个远端数据中心或者亚马逊的S3(可能加密),非常适用于灾难恢复.
    3. RDB在保存RDB文件时父进程唯一需要做的就是fork出一个子进程,接下来的工作全部由子进程来做,父进程不需要再做其他IO操作,所以RDB持久化方式可以最大化redis的性能.
    4. 与AOF相比,在恢复大的数据集的时候,RDB方式会更快一些.
- 缺点
    1. 如果希望在redis意外停止工作的情况下丢失的数据最少的话,那么RDB不适合
    2. RDB需要经常fork子进程来保存数据集到硬盘上,当数据集比较大的时候,fork的过程是非常耗时的,可能会导致redis在一些毫秒级内不能相应客户端的请求

#### AOF的优缺点
- 优点
    1. 使用AOF会让你的redis更加耐久
    2. AOF文件是一个只进行追加的日志文件,所以不需要写入seek,即使由于某些原因(磁盘空间已满,写的过程中宕机等)未执行完整的写入命令,你也可使用redis-check-aof工具修复这些问题.
    3. redis可以在aof文件体积变得过大时,自动的在后台对aof进行重写.
    4. aof文件有序地保存了对数据库执行的所有写入操作,这些写入操作以redis协议的格式保存,因此aof文件的内容非常容易被人读懂,对文件进行分析(parse)也很轻松.
- 缺点
    1. 对于相同的数据集来说,aof文件的体积通常要大于rdb文件的体积.
    2. 根据所使用的fsync策略,aof的速度可能会慢于rdb

