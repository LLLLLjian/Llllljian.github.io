---
title: Interview_总结 (79)
date: 2020-03-20
tags: 
    - MySQL 
    - Interview
toc: true
---

### 面试题
    今日被问傻系列-MySQL索引 B+树

<!-- more -->

#### 索引在 MySQL 数据库中分三类
- B+树索引
- Hash索引
- 全文索引

#### 树树树树
- 二叉查找树
    * 二叉查找树的特点就是任何节点的左子节点的键值都小于当前节点的键值, 右子节点的键值都大于当前节点的键值
    * 二叉树的查找过程(查找ID=12的用户)
        * 只需要3次查找
        * 将根节点作为当前节点, 把 12 与当前节点的键值 10 比较, 12 大于 10, 接下来我们把当前节点>的右子节点作为当前节点.
        * 继续把 12 和当前节点的键值 13 比较, 发现 12 小于 13, 把当前节点的左子节点作为当前节点.
        * 把 12 和当前节点的键值 12 对比, 12 等于 12, 满足条件, 我们从当前节点中取出 data, 即 id=12, name=xm.
![二叉查找树](/img/20200320_1.jpg)
- 平衡二叉树
    * 在满足二叉查找树特性的基础上, 要求每个节点的左右子树的高度差不能超过 1
![平衡二叉树](/img/20200320_2.jpg)
- B树
    * 单个节点可以存储多个键值和数据的平衡树, 可以更矮胖, 减少磁盘IO
![B树](/img/20200320_3.jpg)
- B+树
    * B+树非叶子节点上是不存储数据的, 仅存储键值, 而 B 树节点中不仅存储键值, 也会存储数据
    * B+树索引的所有数据均存储在叶子节点, 而且数据是按照顺序排列的
![B+树](/img/20200320_4.jpg)

#### 利用聚集索引查找数据
- 要执行的SQL
    ```sql
        select * from user where id >= 18 and id < 40
    ```
- 查找过程
    1. 一般根节点都是常驻内存的, 也就是说页 1 已经在内存中了, 此时不需要到磁盘中读取数据, 直接从内存中读取即可.从内存中读取到页 1, 要查找这个 id>=18 and id <40 或者范围值, 我们首先需要找到 id=18 的键值.从页 1 中我们可以找到键值 18, 此时我们需要根据指针 p2, 定位到页 3
    2. 要从页 3 中查找数据, 我们就需要拿着 p2 指针去磁盘中进行读取页 3.从磁盘中读取页 3 后将页 3 放入内存中, 然后进行查找, 我们可以找到键值 18, 然后再拿到页 3 中的指针 p1, 定位到页 8
    3. 根据二分查找法定位到键值 18,  因为是范围查找, 而且此时所有的数据又都存在叶子节点, 并且是有序排列的, 那么我们就可以对页 8 中的键值依次进行遍历查找并匹配满足条件的数据.我们可以一直找到键值为 22 的数据, 然后页 8 中就没有数据了, 此时我们需要拿着页 8 中的 p 指针去读取页 9 中的数据
    4. 因为页 9 不在内存中, 就又会加载页 9 到内存中, 并通过和页 8 中一样的方式进行数据的查找, 直到将页 12 加载到内存中, 发现 41 大于 40, 此时不满足条件.那么查找到此终止
![聚集索引](/img/20200320_5.jpg)

#### 利用非聚集索引查找数据
- 要执行的SQL
    ```sql
        select * from user where luckNum = 33
    ```
- 查找过程
    * 查找过程同聚集索引查找数据, 最后多一步回表过程, 通过主键再去聚簇索引中查找数据的内容
![非聚集索引](/img/20200320_5.jpg)