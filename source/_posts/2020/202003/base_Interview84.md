---
title: Interview_总结 (84)
date: 2020-03-27
tags: 
    - HTTP
    - Interview
toc: true
---

### 面试题
    今日被问傻系列

<!-- more -->

#### 一个URL请求到服务器返回的全过程
> DNS解析->TCP链接->发送HTTP请求->服务器处理请求->浏览器解析渲染页面->连接结束
1. 用户输入url,浏览器内部代码将url进行拆分解析；
2. 浏览器首先去找本地的hosts文件,检查在该文件中是否有相应的域名、IP对应关系,如果有,则向其IP地址发送请求,如果没有就会将domain(域)发送给 dns(域名服务器)进行解析,将域名解析成对应的服务器IP地址,发回给浏览器；
3. 应用层客户端发送HTTP请求；
4. 传输层TCP传输报文；
5. 接着：网络层IP协议查询MAC地址；( 在找到对方的MAC地址后,就将数据发送到数据链路层传输.这时,客户端发送请求的阶段结束)
6. 服务器接收数据(接收端的服务器在链路层接收到数据包,再层层向上直到应用层.这过程中包括在运输层通过TCP协议将分段的数据包重新)
7. 服务器响应请求；最后： 服务器返回相应文件

#### TCP为什么要三次握手
1. 客户端发送请求【寻址请求】
    * Client将标志位SYN置1,随机产生一个值seq=J,并将数据包发给Server Client进入SYN_SENT状态,等待Server确认
    * 让我们建立连接吧, 我发送的信号序列会从456开始
2. 服务器端收到报文请求,回应客户端【确认请求】
    * Server收到数据包后标志位SYN=1知道Client请求建立连接,Server将标志位SYN和ACK都置1, 随机产生一个值,并将数据包发给Client确认连接请求,Server进入SYN_RCVD状态
    * 收到, 我已经准备好接收序号457了, 我发送的信息序号会从123开始
3. 客户端收到服务端的报文进行回应.【连接请求】
    * Client收到确认后若ACK为1,则将该数据包发送给Server,Server检查ACK为1则连接建立成功, Client与Server进入ESTABLISHED状态完成三次握手,可以传输数据
    * 很好, 我也收到了你的序号, 可以向我发送编号124的信息了
- 套娃说法
    * 传输开始前,A知道自己的序列号,B知道自己的序列号.第一次握手,B知道了A的序列号；第二次握手,A知道B知道A的序列号；第三次握手,B知道A知道B的序列号.这样,对于A和B而言,都知道“对方已经知道自己的序列号”这一现实,所以TCP连接可以建立

#### TCP为什么要四次挥手
1. 数据验证请求码
    * Clien发送一个FIN,用来关闭Client到Server的数据传送,Client进入FIN_WAIT_1状态
2. 传输结束标记
    * Server收到FIN后,发送一个ACK给Client,Server进入CLOSE_WAIT状态
3. 确认结束标记
    * Server发送一个FIN,用来关闭Server到Client的数据传送,Server进入LAST_ACK状态
4. 连接断开标记
    * Client收到FIN后,Client进入TIME_WAIT状态,发送ACK给Server,Server进入CLOSED状态,完成四次握手
- 总结
    * 前两次挥手是为了断开client至server的连接,后两次挥手是为了断开server至client的连接,如果没有第四次挥手,会出现如下状况：server发送FIN数据包并携带ACK至client之后直接断开连接,如果client没有收到这个FIN数据包,那么client会一直处于等待关闭状态,这是为了确保TCP协议是面向连接安全有保证锝.上面解释了为什么不是三次挥手,同理,两次挥手也是不安全的.不能保证server与client都能正确关闭连接释放资源,而不会造成资源浪费

#### TCP与UDP理解与区别
- TCP
    1. TCP(Transmission Control Protocol传输控制协议)
    2. 传输层协议
    3. 原因：应用层需要可靠的连接,但是IP层没有这样的流机制
    4. 面向连接,即在客户端和服务器之间发送数据之间,必须先建立连接
    5. 位于应用层和IP层之间
    6. 连接需要建立三次握手、四次挥手断开连接
    7. 传输数据时可靠的
- UDP
    1. UDP(User Datagram Protocol用户数据报协议)
    2. 传输层协议
    3. 无连接的数据报协议
    4. 不能提供数据报分组,组装和不能对数据报进行排序
    5. 主要用于不要求分组顺序到达的传输中,分组传输顺序的检查和排序有应用层完成.
    6. 提供面向事务的简单不可靠传递服务.
    7. UDP协议使用端口分别运行在同一台设备上的多个应用程序
    8. 功能：为了在给定的主句上能识别多个目的的地址, 同时允许多个应用程序在同一台主句上工作并能够独立地进行数据包的发送和接受,设计用户数据报协议UDP
- 区别
    1. TCP是面向连接的(在客户端和服务器之间传输数据之前要先建立连接),UDP是无连接的(发送数据之前不需要先建立连接)
    2. TCP提供可靠的服务(通过TCP传输的数据.无差错,不丢失,不重复,且按序到达)；UDP提供面向事务的简单的不可靠的传输.
    3. UDP具有较好的实时性,工作效率比TCP高,适用于对高速传输和实时性比较高的通讯或广播通信.随着网速的提高,UDP使用越来越多.
    4. 没一条TCP连接只能是点到点的,UDP支持一对一,一对多和多对多的交互通信.
    5. TCP对系统资源要去比较多,UDP对系统资源要求比较少
    6. UDP程序结构更加简单
    7. TCP是流模式,UDP是数据报模式

#### HTTP请求包含哪几个部分
1. 请求报文(请求行/请求头/请求数据/空行)
    * 请求行 请求方法字段、URL字段和HTTP协议版本 例如：GET /index.html HTTP/1.1 get方法将数据拼接在url后面,传递参数受限,请求方法： GET、POST、HEAD、PUT、DELETE、OPTIONS、TRACE、CONNECT
    * 请求头(key value形式) User-Agent：产生请求的浏览器类型. Accept：客户端可识别的内容类型列表. Host：主机地址
    * 请求数据 post方法中,会把数据以key value形式发送请求 空行 发送回车符和换行符,通知服务器以下不再有请求头
2. 响应报文(状态行、消息报头、响应正文)
    * 状态行是由：HTTP-Version+Status-Code+Reason-Phrase 比如：HTTP/1.1 200 ok 分别表示HTTP版本 + 状态码 + 状态代码的文本描述
    * 响应头：包含服务器类型,日期,长度,内容类型等 Server:Apache Tomcat/5.0.12 Date:Mon,6Oct2003 13:13:33 GMT Content-Type:text/html Last-Moified:Mon,6 Oct 2003 13:23:42 GMT Content-Length:112
    * 响应正文 响应正文就是服务器返回的HTML页面或者json数据

#### HTTP和HTTPS区别
1. HTTPS协议需要到ca申请证书,一般免费证书较少,因而需要一定费用.
2. HTTP是超文本传输协议,信息是明文传输,HTTPS则是具有安全性的ssl加密传输协议.
3. HTTP和HTTPS使用的是完全不同的连接方式,用的端口也不一样,前者是80,后者是443.
4. HTTP的连接很简单,是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议,比HTTP协议安全.

