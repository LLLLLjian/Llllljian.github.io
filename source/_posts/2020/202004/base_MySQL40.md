---
title: MySQL_基础 (40)
date: 2020-04-03
tags: 
    - MySQL 
    - Interview
toc: true
---

### 更好的理解MySQL
    查询和更新的内部实现

<!-- more -->

#### MySQL结构
![MySQL执行示意图](/img/20200403_1.png)
1. 连接器
    * 连接器负责跟客户端建立连接、获取权限、维持和管理连接
2. 分析器
    * 分析器有两个功能: 词法分析、语法分析
3. 缓存
    * 这里的缓存会保存之前的sql查询语句和结果.你可以理解为这是一个map: key是查询的sql语句,value是查询的结果
4. 优化器
    * 查询优化器的任务是发现执行SQL查询的最佳方案.大多数查询优化器,包括MySQL的查询优化器,总或多或少地在所有可能的查询评估方案中搜索最佳方案.

#### 查询语句的执行过程
> select * from T where ID = 1；
1. 连接器与客户端建立连接
2. 分析器进行简单的语句分析(验证SQL是否正确), 当检验到是SELECT语句的时候去缓存中查询一下
3. 缓存命中直接返回查询结果, 未命中则交给优化器进行SQL优化
4. 执行器返回表T中ID为1的数据所在的**数据页**

#### 更新语句的执行过程
> update T set a = a + 1 where ID = 0;
![MySQL更新语句执行示意图](/img/20200403_2.png)
1. 经过连接器,分析器,分析器发现这是一条update语句,于是继续语法分析,优化器,执行器.执行器判断有权限,然后开表,引擎找到了包含了ID为0这行数据的数据页,将这一页数据保存在内存中
2. 更新内存中的数据页
3. 写入<a href="#desc1">redo log</a>中
4. 写入<a href="#desc2">bin log</a>中

#### <span id="desc1">redo log</span>
> rodo log(重做日志)
重做日志在更新数据的时候,会记录在哪个数据页更新了什么数据,并且只要成功的在重做日志记录了这次更新,不需要将内存中的数据页写回磁盘,就可以认为这次更新已经完成了

#### <span id="desc2">bin log</span>
> bin log(归档日志)
归档日志是追加写的,在一个文件写满后就会切换到下一个文件继续写,会记录每一条语句更改了什么内容





