---
title: Interview_总结 (95)
date: 2020-05-21
tags: Interview
toc: true
---

### 面试题
    面试题汇总

<!-- more -->

#### 网站统计
> 网站流量统计可以帮助我们分析网站的访问和广告来访等数据,里面包含很多数据的,比如访问使用的系统,浏览器,ip归属地,访问时间,搜索引擎来源,广告效果等.
- PV(访问量)
    * Page View, 即页面浏览量或点击量,用户每次刷新即被计算一次.
- UV(独立访客)
    * Unique Visitor,一般使用cookie标记,访问您网站的一台电脑客户端(比如一台电脑开多个浏览器访问则为多个UV)为一个访客,00:00-24:00内相同的客户端只会被计算一次.
- IP(独立IP)
    * 指独立IP数.00:00-24:00内相同IP地址之被计算一次(多台电脑可能共用一个ip).
- IP、PV、UV的区别：
    * IP(独立IP)
        * 某IP地址的计算机访问网站的次数.这种统计方式很容易实现,具有真实性.所以是衡量网站流量的重要指标.
    * PV(访问量)
        * PV反映的是浏览某网站的页面数,所以每刷新一次也算一次.就是说PV与来访者的数量成正比,但PV并不是页面的来访者数量,而是网站被访问的页面数量.
    * UV(独立访客)
        * 可以理解成访问某网站的电脑的数量.网站判断来访电脑的身份是通过来访电脑的cookies实现的.如果更换了IP后但不清除cookies,再访问相同网站,该网站的统计中UV数是不变的.

#### nginx统计访问量
    ```bash
        # 1.根据访问IP统计UV
        awk '{print $1}'  access.log|sort | uniq -c |wc -l
        
        # 2.统计访问URL统计PV
        awk '{print $7}' access.log|wc -l
        
        # 3.查询访问最频繁的URL
        awk '{print $7}' access.log|sort | uniq -c |sort -n -k 1 -r|more
        
        # 4.查询访问最频繁的IP
        awk '{print $1}' access.log|sort | uniq -c |sort -n -k 1 -r|more
        
        # 5.根据时间段统计查看日志
        cat  access.log| sed -n '/14\/Mar\/2015:21/,/14\/Mar\/2015:22/p'|more
    ```

#### 基本思路1
> 每一个页面一个独立的 set 集合来存储所有当天访问过此页面的用户 ID.当一个请求过来时,我们使用 sadd 将用户 ID 塞进去就可以了.通过 scard 可以取出这个集合的大小,这个数字就是这个页面的用户访问量数据.但是,页面访问量非常大,每天有几千万的用户访问量,需要一个很大的 set 集合来做统计,这就非常浪费空间.如果不止一个页面需要统计,那所需要的存储空间是非常巨大的.仅仅为这样一个统计功能去耗费大量的空间,是不划算的.同时,我们也考虑到实际的业务需求对用户访问量这个数字并不需要特别的精确,只需要算出一个大概即可

#### 使用HyperLogLog

