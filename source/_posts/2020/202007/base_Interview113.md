---
title: Interview_总结 (113)
date: 2020-07-13
tags: Interview
toc: true
---

### 面试题
    面试题汇总-如何设计一个安全的对外接口

<!-- more -->

#### 安全措施
1. 如何保证数据在传输过程中的安全性
2. 数据已经到达服务器端, 服务器端如何识别数据, 如何不被攻击

##### 数据加密
> 我们知道数据在传输过程中是很容易被抓包的, 如果直接传输比如通过http协议, 那么用户传输的数据可以被任何人获取；所以必须对数据加密, 常见的做法对关键字段加密比如用户密码直接通过md5加密；现在主流的做法是使用https协议, 在http和tcp之间添加一层加密层(SSL层), 这一层负责数据的加密和解密
- 对称加密
    * 对称密钥在加密和解密的过程中使用的密钥是相同的, 常见的对称加密算法有DES, AES；优点是计算速度快, 缺点是在数据传送前, 发送方和接收方必须商定好秘钥, 然后使双方都能保存好秘钥, 如果一方的秘钥被泄露, 那么加密信息也就不安全了；
- 非对称加密
    * 服务端会生成一对密钥, 私钥存放在服务器端, 公钥可以发布给任何人使用；优点就是比起对称加密更加安全, 但是加解密的速度比对称加密慢太多了；广泛使用的是RSA算法；

##### 数据加签
> 数据加签就是由发送者产生一段无法伪造的一段数字串, 来保证数据在传输过程中不被篡改；你可能会问数据如果已经通过https加密了, 还有必要进行加签吗？数据在传输过程中经过加密, 理论上就算被抓包, 也无法对数据进行篡改；但是我们要知道加密的部分其实只是在外网, 现在很多服务在内网中都需要经过很多服务跳转, 所以这里的加签可以防止内网中数据被篡改；
- 数据签名使用比较多的是md5算法, 将需要提交的数据通过某种方式组合和一个字符串, 然后通过md5生成一段加密字符串

##### 时间戳机制
> 数据是很容易被抓包的, 但是经过如上的加密, 加签处理, 就算拿到数据也不能看到真实的数据；但是有不法者不关心真实的数据, 而是直接拿到抓取的数据包进行恶意请求；这时候可以使用时间戳机制, 在每次请求中加入当前的时间, 服务器端会拿到当前时间和消息中的时间相减, 看看是否在一个固定的时间范围内比如5分钟内；这样恶意请求的数据包是无法更改里面时间的, 所以5分钟后就视为非法请求了
- 解密后的数据, 经过签名认证后, 我们拿到数据包中的客户端时间戳字段, 然后用服务器当前时间去减客户端时间, 看结果是否在一个区间内

##### AppId机制
> 大部分网站基本都需要用户名和密码才能登录, 并不是谁来能使用我的网站, 这其实也是一种安全机制；对应的对外提供的接口其实也需要这么一种机制, 并不是谁都可以调用, 需要使用接口的用户需要在后台开通appid, 提供给用户相关的密钥；在调用的接口中需要提供 appid+密钥, 服务器端会进行相关的验证
- 生成一个唯一的AppId即可, 密钥使用字母、数字等特殊字符随机生成即可；生成唯一AppId根据实际情况看是否需要全局唯一；但是不管是否全局唯一最好让生成的Id有如下属性: 趋势递增: 这样在保存数据库的时候, 使用索引性能更好；信息安全: 尽量不要连续的, 容易发现规律

##### 限流机制
> 本来就是真实的用户, 并且开通了appid, 但是出现频繁调用接口的情况；这种情况需要给相关appid限流处理, 常用的限流算法有令牌桶和漏桶算法；
- 固定窗口计数器算法
    * 规定我们单位时间处理的请求数量.比如我们规定我们的一个接口一分钟只能访问10次的话.使用固定窗口计数器算法的话可以这样实现: 给定一个变量counter来记录处理的请求数量, 当1分钟之内处理一个请求之后counter+1, 1分钟之内的如果counter=100的话, 后续的请求就会被全部拒绝.等到 1分钟结束后, 将counter回归成0, 重新开始计数(ps: 只要过了一个周期就讲counter回归成0).
    * 这种限流算法无法保证限流速率, 因而无法保证突然激增的流量.比如我们限制一个接口一分钟只能访问10次的话, 前半分钟一个请求没有接收, 后半分钟接收了10个请求
- 滑动窗口计数器算法
    * 它把时间以一定比例分片比如一分钟分为6个区间, 每个区间为10s.每过一定区间的时间, 就抛弃最前面的一个区间, 如下图所示.如果当前窗口的请求数量超过了限制数量的话, 就拒绝后续请求.
- 漏桶算法
    * 我们可以把发请求的动作比作成注水到桶中, 我们处理请求的过程可以比喻为漏桶漏水.我们往桶中以任意速率流入水, 以一定速率流出水.当水超过桶流量则丢弃, 因为桶容量是不变的, 保证了整体的速率.如果想要实现这个算法的话也很简单, 准备一个队列用来保存请求, 然后我们定期从队列中拿请求来执行就好了
- 令牌桶算法
    * 令牌桶算法也比较简单.和漏桶算法算法一样, 我们的主角还是桶(这限流算法和桶过不去啊).不过现在桶里装的是令牌了, 请求在被处理之前需要拿到一个令牌, 请求处理完毕之后将这个令牌丢弃(删除).我们根据限流大小, 按照一定的速率往桶里添加令牌

##### 黑名单机制
> 如果此appid进行过很多非法操作, 或者说专门有一个中黑系统, 经过分析之后直接将此appid列入黑名单, 所有请求直接返回错误码；

##### 数据合法性校验
> 这个可以说是每个系统都会有的处理机制, 只有在数据是合法的情况下才会进行数据处理；每个系统都有自己的验证规则, 当然也可能有一些常规性的规则, 比如身份证长度和组成, 电话号码长度和组成等等


