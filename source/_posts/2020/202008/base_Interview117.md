---
title: Interview_总结 (117)
date: 2020-08-17
tags: Interview
toc: true
---

### 高并发
    高并发和大流量解决方案考察点

<!-- more -->

#### 减少HTTP请求
- 性能黄金法则: 
    * 只有10%-20%的最终用户响应时间花在接收请求的HTML文档上,剩下的时间花在HTML文档所引用的所有组件(图片,css,flash等)进行的HTTP请求上.
- 如何改善: 
    * 减少组件的数量,并由此减少HTTP请求的数量.
    * HTTP连接产生的开销: 域名解析——TCP连接——发送请求——等待——下载资源——解析时间
- 减少HTTP请求的方式
    1. 图片地图
        * 图片地图允许你在一个图片上关联多个URL,目标URL的选择取决于用户单击了图片上的哪个位置.(将多个图片合成一张图片,以位置信息定位超链接). 好处: 把HTTP请求减少为一个,可以保证设计的完整性和功能的齐全性
    2. CSS Sprites
        * CSS Sprites中文翻译为CSS精灵,通过使用合并图片,通过指定css的background-image和backgroud-position来显示元素.
        * backgroud-position属性
        * backgroud-position:x y;x和y可以写负值或者正值,我们可以想象图片的左上方为(0,0),以(0,0)坐标向右是为负数的x轴,以(0,0)坐标向下是为负数的y轴.
    3. 合并脚本和样式表
        * 使用外部的js和css文件引用的方式,因为这要比直接写在页面中性能要好一点
        * 独立的一个js比用多个js文件组成的页面载入要快38%
        * 把多个脚本合并为一个脚本,把多个样式表合并成一个样式表
    4. 图片使用Base64编码减少页面请求数
        * 采用Base64的编码方式将图片直接嵌入到网页中,而不是从外部载入,如: <img src="data:image/gif;base64,/9j/4AAQWS....">

#### CDN加速
- 什么是CDN
    * CDN的全称是Content Delivery Network,即内容分发网络.
    * 尽可能避免互联网上有可能影响数据传输速度和稳定性的瓶颈和环节,使内容传输的更快,更稳定
    * 在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络
    * CDN系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上
- 使用CDN的优势
    * 本地Cache加速,提高了企业站点的访问速度
    * 跨运营商的网络加速,保证不同网络的用户都得到良好的访问质量
    * 远程访问用户根据DNS负载均衡技术智能自动选择Cache服务器
    * 自动生成服务器的远程Mirror(镜像)cache服务器,远程用户访问时从cache服务器上读取数据,减少远程访问的带宽,分担网络流量,减轻原站点web服务器负载等功能
    * 广泛分布的CDN节点加上节点之间的智能冗余机制,可以有效地预防黑客入侵
- CDN的工作原理
    1. 传统访问
        * 用户在浏览器输入域名发起请求->解析域名获取服务器IP地址->根据IP地址找到对应的服务器->服务器响应并返回数据
    2. 使用CDN访问
        * 用户在浏览器输入域名发起请求->智能DNS的解析(根据IP判断地理位置,接入网类型,选择路由最短和负载最轻的服务器)->取得缓存服务器IP地址->把内容返回给用户(如果缓存中有)->向源站发起请求器->把结果返回给用户->将结果存入缓存服务器
- CDN的适用场景
    * 站点或者应用中大量静态资源的加速分发,例如: CSS,JS,图片和HTML
    * 大文件下载
    * 直播网站等
- CDN的实现
    1. BAT等都有提供CDN服务
    2. 可用LVS做4层负载均衡(高性能 高可用的Yii2.0 电商平台课程中有讲)
    3. 可用Nginx,Varnish,Squid,Apache TrafficServer做7层负载均衡和cache
    4. 使用squid反向代理,或者Nginx等的反向代理

#### 独立图片服务器的部署
- 独立的必要性
    * 分担web服务器的I/O负载-将耗费资源的图片服务分离出来,提高服务器的性能和稳定性
    * 能够专门对图片服务器进行优化-为图片服务设置有针对性的缓存方案,减少带宽成本,提高访问速度
    * 提高网站的可扩展性-通过增加图片服务器,提高图片吞吐能力
- 采用独立域名的必要性
    * 同一域名下浏览器的并发连接数有限制,突破浏览器连接数的限制
    * 由于cookie的原因,对缓存不利,大部分web cache都只缓存不带cookie的请求,导致每次的图片请求都不能命中cache
- 独立后如何进行图片上传和图片同步
    * NFS共享方式
    * 利用FTP同步

#### 动态语言静态化
- 什么是动态语言静态化
    * 将现有PHP等动态语言的逻辑代码生成为静态HTML文件,用户访问动态脚本重定向到静态HTML文件的过程.
    * 对实时性要求不高的页面
- 为什么要静态化
    1. 动态脚本通常会做逻辑计算和数据结构,访问量越大,服务器压力越大
    2. 访问量大时可能会造成CPU负载过高,数据库服务器压力过大
    3. 静态化可以减低逻辑处理压力,降低数据库服务器查询压力
- 静态化的实现方式
    1. 使用模板引擎
    2. 利用ob系列的函数
