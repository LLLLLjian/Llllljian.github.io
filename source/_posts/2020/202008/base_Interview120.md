---
title: Interview_总结 (120)
date: 2020-08-20
tags: Interview
toc: true
---

### 一致性哈希
    今日被问傻系列-一致性哈希

<!-- more -->

#### 问题引入
> 通过取模结果进行分表, 由于数据量的暴增, 需要重新分表

#### 一致性哈希
> 一致性哈希建成DHT, 主要应用于分布式缓存中
- 好处
    * 可以有效解决分布式存储结构下动态增加和删除节点所带来的问题
1. 首先,我们把全量的缓存空间当做一个环形存储结构.环形空间总共分成2^32个缓存区,在Redis中则是把缓存key分配到16384个slot
![一致性哈希1](/img/20200820_1.png)
2. 每一个缓存key都可以通过Hash算法转化为一个32位的二进制数,也就对应着环形空间的某一个缓存区.我们把所有的缓存key映射到环形空间的不同位置
![一致性哈希2](/img/20200820_2.png)
3. 我们的每一个缓存节点(Shard)也遵循同样的Hash算法,比如利用IP做Hash,映射到环形空间当中.
![一致性哈希3](/img/20200820_3.png)
4. 如何让key和节点对应起来呢？很简单,每一个key的顺时针方向最近节点,就是key所归属的存储节点.所以图中key1存储于node1,key2,key3存储于node2,key4存储于node3
![一致性哈希4](/img/20200820_4.png)
5. 增加节点: 当缓存集群的节点有所增加的时候,整个环形空间的映射仍然会保持一致性哈希的顺时针规则,所以有一小部分key的归属会受到影响
![一致性哈希5](/img/20200820_5.png)
6. 删除节点: 当缓存集群的节点需要删除的时候(比如节点挂掉),整个环形空间的映射同样会保持一致性哈希的顺时针规则,同样有一小部分key的归属会受到影响.
![一致性哈希6](/img/20200820_6.png)
7. 虚拟节点: 防止数据分布不均匀
![一致性哈希7](/img/20200820_7.png)

