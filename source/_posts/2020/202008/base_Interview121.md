---
title: Interview_总结 (121)
date: 2020-08-21
tags: Interview
toc: true
---

### B树B树B树B树
    今日被问傻系列-我的心里为啥没B树

<!-- more -->

#### 开胃菜
- 二叉搜索树
    * 若它的左子树不空,则左子树上所有结点的值均小于它的根结点的值； 若它的右子树不空,则右子树上所有结点的值均大于它的根结点的值
    * 由于无法保证平衡,可能退化为链表
- 二叉平衡树
    * 任意节点的子树的高度差都小于等于1
    * 通过旋转解决了平衡的问题,但是旋转操作效率太低
- 二叉平衡搜索树(AVL树)
    * 二叉搜索树 + 二叉平衡树
    * 树太高,IO次数多
- 红黑树
    * 红黑树是平衡二叉树和AVL树的折中, 因此是比较合适的.集合类中的Map、关联数组具有较高的查询效率, 它们的底层实现就是红黑树
    * 树太高,IO次数多
- B树
    * 矮胖
    * 一个m阶的B树特性
    1. 根结点至少有两个子女
    2. 每个中间节点都包含k-1个元素和k个孩子,其中 m/2 <= k <= m
    3. 每一个叶子节点都包含k-1个元素,其中 m/2 <= k <= m
    4. 所有的叶子结点都位于同一层.
    5. 每个节点中的元素从小到大排列,节点当中k-1个元素正好是k个孩子包含的元素的值域分划
    * 节点要存数索引和数据,一个内存页可存储的数据还是少,另外范围查找也需要多次IO
- B+树
    * 更矮胖
    * 一个m阶的B+树特性
    1. 有k个子树的中间节点包含有k个元素(B树中是k-1个元素),每个元素不保存数据,只用来索引,所有数据都保存在叶子节点.
    2. 所有的叶子结点中包含了全部元素的信息,及指向含这些元素记录的指针,且叶子结点本身依关键字的大小自小而大顺序链接.
    3. 所有的中间节点元素都同时存在于子节点,在子节点元素中是最大(或最小)元素

#### B树
> 一个3阶B树为例

![3阶B树](/img/20200821_1.png)
- 查(查询的数值是5)
    * 第一次磁盘IO, 在内存中和9比较, 然后选择左子树
    * 第二次磁盘IO, 在内存中和2/6比较, 然后选择中间节点
    * 第三次磁盘IO, 在内存中和3/5比较, 返回数值5
- 增(增加的数值是4)
    * 发现4应该插入到节点元素3/5中, 但是B树特性3, 每个叶子节点中包含2个元素(因为是3阶, 所以是3-1)
    * 父节点2/6也是双元素节点, 所以升级跟节点9, 升级为4/9, 2和6变成根节点的子节点
- 删(删除的数值是11)
    * 删除节点11之后, 节点12只有一个孩子, 且子节点中有两个元素, 所以发生左旋, 13替换12的位置, 12变为13的子节点, 15不动
- 应用
    * 主要应用于文件系统以及部分数据库索引优化, 比如mongodb



