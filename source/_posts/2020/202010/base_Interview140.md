---
title: Interview_总结 (140)
date: 2020-10-16
tags: Interview
toc: true
---

### 面试题
    别看了 这就是你的题
    框架相关(6)

<!-- more -->

#### 消息中间件

##### 消息队列概述
> 消息队列中间件是分布式系统中重要的组件, 主要解决应用耦合、异步消息、流量削锋等问题.实现高性能、高可用、可伸缩和最终一致性架构.是大型分布式系统不可缺少的中间件
目前在生产环境, 使用较多的消息队列有ActiveMQ、RabbitMQ、ZeroMQ、Kafka、MetaMQ、RocketMQ等

##### 消息队列应用场景
- 异步调用
    * 假设有一个系统调用链路, 是系统A调用系统B, 一般耗时20ms；系统B调用系统C, 一般耗时200ms；系统C调用系统D, 一般耗时2s
    ![系统调用](/img/20201016_1.png)
    * 可以看到因为加入了系统D, 调用性能降低了10倍, 所以我们想着把D抽离出去做成异步调用
    ![异步调用](/img/20201016_2.png)
- 系统解耦
    * 系统A会产出一个核心数据给系统B、系统C、系统D......
    ![系统解耦前](/img/20201016_3.png)
    * 后期随着系统的增加, 或者下游系统出问题会导致整个系统崩溃, 所以我们就想到了系统解耦
    ![系统解耦后](/img/20201016_4.png)
- 流量削锋
    * 假设有一个瞬间有好几千请求打到你的机器上, 但是你机器承受不了这么多, 那就爆炸了
    ![流量削锋前](/img/20201016_5.png)
    * 那能不能固定让机器只承受1000的请求
    ![流量削锋前](/img/20201016_6.png)
- 消息通讯
    * 要给10w个人发推送, 那也不能一个循环里10w的数据然后发吧
    ![消息通讯](/img/20201016_7.png)

##### 常用消息队列
- Active MQ
- Rabbit MQ
    ![Rabbit MQ](/img/20201016_8.png)
    * 名词解释
        * Broker: 简单来说就是消息队列服务器实体.
        * Exchange: 消息交换机, 它指定消息按什么规则, 路由到哪个队列
        * Queue: 消息队列载体, 每个消息都会被投入到一个或多个队列
        * Binding: 绑定, 它的作用就是把Exchange和Queue按照路由规则绑定起来
        * Routing Key: 路由关键字, Exchange根据这个关键字进行消息投递
        * vhost: 虚拟主机, 一个broker里可以开设多个vhost, 用作不同用户的权限分离
        * producer: 消息生产者, 就是投递消息的程序
        * consumer: 消息消费者, 就是接受消息的程序
        * channel: 消息通道, 在客户端的每个连接里, 可建立多个channel, 每个channel代表一个会话任务
    * 使用过程
        * 客户端连接到消息队列服务器, 打开一个channel
        * 客户端声明一个exchange, 并设置相关属性
        * 客户端声明一个queue, 并设置相关属性
        * 客户端使用routing key, 在exchange和queue之间建立好绑定关系
        * 客户端投递消息到exchange
        * exchange接收到消息后, 就根据消息的key和已经设置的binding, 进行消息路由, 将消息投递到一个或多个队列里
- Zero MQ
- Kafka

