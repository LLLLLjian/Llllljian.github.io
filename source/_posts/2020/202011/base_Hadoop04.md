---
title: Hadoop_基础 (04)
date: 2020-11-26
tags: Hadoop
toc: true
---

### 快来跟我一起学HDFS
    还需要学一下大数据
    先看看Hadoop

<!-- more -->

#### 安全模式
1. 指的是集群启动时的一个状态
2. NameNode启动时
    1. 首先将映像文件(fsimage)载入内存, 并执行编辑日志(edits)中的各项操作
    2. 一旦在内存中成功建立文件系统元数据的映像, 则创建一个新的fsimage文件和一个空的编辑日志
    3. NameNode开始坚挺DataNode请求
    4. 此时NameNode运行在安全模式, 即NameNode的文件系统对于客户端来说是只读的
    5. 处于这个状态是为了保护数据的安全所以不可被客户端访问
3. 系统中的数据块的位置并不是由NameNode维护的，而是以块列表的形式存储在DataNode中
4. 安全模式下
    1. DataNode会向NameNode发送最新的块列表信息
    2. NameNode了解到足够多的快位置信息之后，即可搞笑运行文件系统
    3. 如果NN收集Block的信息达到最少副本数，就会脱离安全模式
5. 如果NN收集Block的信息没有达到最少副本数，就会将缺失的副本从有的DN上拷贝到其他DN
    1. dfs.replication.min = 1
    2. 但是默认最低副本数为1
6. 在拷贝的过程中系统还是处于安全模式

#### 机架感知策略
> 为了保证副本在集群上的安全性, 我们需要将副本放在不同的DN节点上, 节点也需要一定的考量
1. 第一个节点
    * 集群内部
        * 优先考虑和客户端相同节点作为第一个节点
    * 集群外部
        * 选择资源丰富且不繁忙的节点作为第一个节点
2. 第二个节点
    * 选择和第一个节点不同机架的其他节点
3. 第三个节点
    * 选择和第二个节点相同机架的其他节点
4. 第N个节点
    * 选择与前面节点不重复的其他节点



