---
title: 读书笔记 (04)
date: 2021-06-21
tags: Book
toc: true
---

### 还是要多读书鸭
    Docker容器与容器云读书笔记

<!-- more -->

#### 故事背景
> 我只会docker run, 还是要深入的看看底层的知识, 高T给推荐了一本书, 写一写读书笔记

#### Docker核心原理解读
> Docker通过namespace实现了资源隔离, 通过cgroups实现了资源限制, 通过写时复制(copy-on-write)实现了高效的文件操作

- 实现一个资源隔离的容器需要从哪些方面下手
    * 文件系统隔离: 使用后根目录的挂载点发生切换
    * 网络隔离: 容器必须有独立的IP、端口、路由等
    * 网络独立: 需要独立的主机名在网络中标示自己
    * 进程间通信隔离: 有了网络自然离不开通信, 信号量、消息队列和共享内存
    * 用户权限隔离: 权限问题, 需要对用户和用户组进行隔离
    * 进程号隔离: 在容器中运行的应用需要有进程号(PID), 自然也需要与宿主机中的PID进行隔离
- cgroups资源限制
    1. cgroups是什么
        * cgroups是Linux内核提供的一种机制, 这种机制可以根据需求把一系列系统任务及其子任务整合(或分隔)到按资源划分等级的不同组内, 从而为系统资源管理提供一个统一的框架.通俗地说, .cgroups可以限制、记录任务组所使用的物理资源(包括CPU、Memory、IO等), 为容器实现虚拟化提供了基本保证, 是构建Docker等一系列虚拟化管理工具的基石
    2. cgroups特点
        * cgroups的API以一个伪文件系统的方式实现, 用户态的程序可以通过文件操作实现cgroups的组织管理
        * cgroups的组织管理操作单元可以细颗粒到线程级别, 另外用户可以出创建和销毁cgroups, 从而实现资源再分配和管理
        * 所有资源管理的功能都以子系统的方式实现, 接口统一
        * 子任务创建之初与其父任务处于同一个cgroups的控制组
    3. cgroups作用
        * 资源限制: cgroups可以对任务使用的资源总额进行限制.如设定应用运行时使用内存的上限, 一旦超过这个配额就发出OOM(Out Of Memory)提示.
        * 优先级分配: 通过分配的CPU时间片数量及磁盘IO宽带大小, 实际上就相当于控制了任务运行的优先级.
        * 资源统计: cgroups可以统计系统的资源使用量, 如CPU使用时长、内存用量等, 这个功能非常适用于计费.
        * 任务控制: cgroups可以对任务执行挂起、恢复等操作.
    4. cgroups术语表
        * task(任务)：在cgroups的术语中, 任务表示一个进程或线程.
        * cgroup(控制组)：cgroups中的资源控制都以cgroup为单位实现.cgroup表示按某种资源控制标准划分而成的控制组, 包含了一个或多个子系统.一个任务可以加入某个cgroup, 也可以从某个cgroup迁移到另外一个cgroup.
        * subsystem(子系统)：cgroups中的子系统就是一个资源调度控制器.比如CPU子系统可以控制CPU时间分配, 内存子系统可以限制cgroup内存使用量.
        * hiererchy(层级)：层级由一系列cgroup以一个树状结构排列而成, 每个层级通过绑定对应的子系统进行资源控制.层级中的cgroup几点可以包括零或多个这几点, 子节点继承父节点挂载的子系统.整个操作系统可以有多个层级.


