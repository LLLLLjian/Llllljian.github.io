---
title: 杂项_总结 (14)
date: 2021-09-10
tags: Others
toc: true
---

### 杂项
    Web Hook

<!-- more -->

#### 什么是Web Hook
> Webhook是一个API概念,并且变得越来越流行.我们能用事件描述的事物越多,webhook的作用范围也就越大.Webhook作为一个轻量的事件处理应用,正变得越来越有用.

简单来说就是一种反向API机制,类似于触发器的一样

- 场景模拟
    * 在传统的web server设计中,我们项目A想要获取项目B的数据,通常项目B需要提供一个API,然后项目A去请求项目B的API,从而获得数据,这样的过程我们称之为"拉"数据.

**通过webhook机制,对客户端-服务端的模式进行了逆转**

- 继续回到场景中
    * 新增了一个需求,项目A需要实时获取到项目B的最新数据,在传统做法中,我们需要不停的去向项目B做轮询操作,以便获取到最新数据,这样的效率和性能都非常低下,通过webhook机制来设计
- 传统做法:项目A需要不停轮询去拉取项目B的最新数据
    ```
        项目A   -> 项目B
    ```
    ![传统做法](/img/20210910_1.png)
- webhook机制:项目A提供一个webhook url,每次项目B创建新数据时,便会向项目A的hook地址进行请求,项目A收到项目B的请求,然后对数据进行处理
    ```
        项目B   -> 项目A
    ```
    ![webhook机制](/img/20210910_2.png)

#### 如何使用webhook

使用webhook就需要为对应的服务端设计一个hook url,用于接收服务端的请求.

例如:
    ```
        http://www.abcd.com/api/video/hook
    ```

通常webhook请求过来的数据格式为xml和json两种,在现代Web应用中,都能很好的解析和对这两种数据进行交互.

#### 主要应用场景

都常应用于异步编程中,如:高安全的支付、微信登录(OAuth)、资源同步、资源创建与更新、耗时较长.

场景A:
你需要向视频处理服务器上传一个视频、你需要获得视频处理后的结果,然而视频处理服务器上视频很多,在排队进行处理,你不能立刻获取到视频的处理结果,此时你可以设计一个hook url,当视频处理完成后,视频处理服务器自动向你的hook url发送请求,告诉你视频已经处理完毕.

#### 安全问题

由于webhook会向公网上的hook url发送数据,这就意味着某些不好心的人可能会找到这个url,从而进行发送错误的数据,但是我们可以通过以下一些技术手段来解决这个问题:
1. 增加token机制
2. 增加auth认证
3. 只接收对应服务端domain或IP请求
4. 数据签名

#### 需要注意的问题

当我们使用web hook机制需要特别注意的问题

1. 当服务提供者通过web hook将数据发送你的服务端后,就不会再去关注这些数据.假设你的服务端此时出现了崩溃,或者无法请求成功等原因,就需要主动去尝试请求数据.
2. webhook会发出大量的请求,可能会造成你的应用阻塞,在此需要确保你的应用能够处理好这些请求.
