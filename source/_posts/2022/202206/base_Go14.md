---
title: Go_基础 (14)
date: 2022-06-22
tags: Go
toc: true
---

### Go语言核心36讲
    Go语言基础-Go语言基础知识

<!-- more -->

#### Go语言基础知识
- GOROOT
    * Go 语言安装根目录的路径, 也就是 GO 语言的安装路径.
- GOPATH
    * 若干工作区目录的路径.是我们自己定义的工作空间.
- GOBIN
    * GO 程序生成的可执行文件(executable file)的路径.
- Q
    * 你知道设置 GOPATH 有什么意义吗
- A
    * 你可以把 GOPATH 简单理解成 Go 语言的工作目录, 它的值是一个目录的路径, 也可以是多个目录路径, 每个目录都代表 Go 语言的一个工作区(workspace).
    * 我们需要利于这些工作区, 去放置 Go 语言的源码文件(source file), 以及安装(install)后的归档文件(archive file, 也就是以“.a”为扩展名的文件)和可执行文件(executable file)

#### Go语言源码的组织方式

与许多编程语言一样, Go 语言的源码也是以代码包为基本组织单位的.在文件系统中, 这些代码包其实是与目录一一对应的.由于目录可以有子目录, 所以代码包也可以有子包.

一个代码包中可以包含任意个以.go 为扩展名的源码文件, 这些源码文件都需要被声明属于同一个代码包.

代码包的名称一般会与源码文件所在的目录同名.如果不同名, 那么在构建、安装的过程中会以代码包名称为准.

每个代码包都会有导入路径.代码包的导入路径是其他代码在使用该包中的程序实体时, 需要引入的路径.在实际使用程序实体之前, 我们必须先导入其所在的代码包.具体的方式就是import该代码包的导入路径.就像这样：

```go
    import "github.com/labstack/echo"
```

在工作区中, 一个代码包的导入路径实际上就是从 src 子目录, 到该包的实际存储位置的相对路径.

所以说, Go 语言源码的组织方式就是以环境变量 GOPATH、工作区、src 目录和代码包为主线的.一般情况下, Go 语言的源码文件都需要被存放在环境变量 GOPATH 包含的某个工作区(目录)中的 src 目录下的某个代码包(目录)中.

#### 理解构建和安装Go程序的过程
- 构建
    * go build
- 安装
    * go install

构建和安装代码包的时候都会执行编译、打包等操作, 并且, 这些操作生成的任何文件都会先被保存到某个临时的目录中.

如果构建的是库源码文件, 那么操作后产生的结果文件只会存在于临时目录中.这里的构建的主要意义在于检查和验证.

如果构建的是命令源码文件, 那么操作的结果文件会被搬运到源码文件所在的目录中.

安装操作会先执行构建, 然后还会进行链接操作, 并且把结果文件搬运到指定目录.

进一步说, 如果安装的是库源码文件, 那么结果文件会被搬运到它所在工作区的 pkg 目录下的某个子目录中.

如果安装的是命令源码文件, 那么结果文件会被搬运到它所在工作区的 bin 目录中, 或者环境变量GOBIN指向的目录中.

#### 命令源码文件
1. 独立程序的入口
2. 属于main包, 包含无参数无结果的main函数
3. main函数执行的结束就意味着当前程序运行的结束
4. 同一个代码包中不要放多个命令源码文件
5. 命令源码文件和库源码文件也不要放在同一个代码包中
6. 构建：构建后生成可执行文件, 生成位置在命令执行目录
7. 安装：安装后生成可执行文件, 生成位置在当前工作区的bin子目录或者GOBIN包含的目录
8. 定义：如果一个源码文件声明属于main包, 并且包含一个无参数声明且无结果声明的main函数, 那么它就是命令源码文件
- demo
    ```go
        package main

        import "fmt"

        func main() {
        fmt.Println("Hello, world!")
        }
    ```
- 命令源码文件怎样接收参数
    ```go
        package main

        import (
            "flag"
            "os"
            "fmt"
        )

        var name string
        var num int

        func init() {
            flag.Usage = func() {
                fmt.Fprintf(os.Stderr, "Usage of %s:\n", "question")
                flag.PrintDefaults()
            }

            // 第 1 个参数是用于存储该命令参数值的地址, 具体到这里就是在前面声明的变量name的地址了, 由表达式&name表示.
            // 第 2 个参数是为了指定该命令参数的名称, 这里是name.
            // 第 3 个参数是为了指定在未追加该命令参数时的默认值, 这里是everyone.
            // 至于第 4 个函数参数, 即是该命令参数的简短说明了, 这在打印命令说明时会用到
            flag.StringVar(&name, "name", "everyone", "The greeting object.")
            // 或者可以直接使用 var name = flag.String("name", "everyone", "The greeting object.")
            var name = flag.String("name", "everyone", "The greeting object.")
            flag.IntVar(&num, "num", 100, "is num")
        }

        func main() {
            flag.Parse()
            fmt.Printf("Hello, %s!\n", name)
        }
    ```

#### 库源码文件
1. 专门用于防止可供其它代码使用的程序实体
2. 构建：作用在于检查和验证, 构建后只生成临时文件, 在操作系统的临时目录下, 开发者一般可以不关心
3. 安装：安装后生成归档文件, 生成位置在当前工作区的pkg子目录

